<div class="alert alert-info" *ngIf="fresh(event)">
  <i class="fas fa-fw fa-info-circle"></i>&nbsp;Podujatie je naplánované. Svoj tím môžete zaregistrovať od
  <span class="fw-bold">{{ event.registration_start | date: 'short' }}</span> .
</div>
<div class="alert alert-success" *ngIf="inReg(event)">
  <i class="fas fa-fw fa-pencil-alt"></i>&nbsp;Prebieha registrácia na podujatie. Registrácia bude ukončená
  <span class="fw-bold">{{ event.registration_end | date: 'short' }}</span> .
</div>
<div class="alert alert-warning" *ngIf="isActive(event)">
  <i class="fas fa-fw fa-clock"></i>&nbsp;Podujatie práve prebieha. Predpokladaný koniec podujatia je
  <span class="fw-bold">{{ event.event_end | date: 'short' }}</span> .
</div>
<div class="alert alert-danger" *ngIf="isFinished(event)">
  <i class="fas fa-fw fa-exclamation-triangle"></i>&nbsp;Podujatie bolo ukončené.
</div>

<h1 class="text-primary d-flex justify-content-between my-4">
  Detail podujatia

  <i class="fas fa-spin fa-spinner" *ngIf="!event"></i>
</h1>
<div class="row" *ngIf="event">
  <div class="col-sm-12 col-lg-6 mb-2">
    <div class="card">
      <div class="card-body">
        <div class="row">
          <div class="col-sm-12 col-md-4 fw-bold"><i class="fas fa-list fa-fw text-primary"></i>&nbsp;Názov</div>
          <div class="col-sm-12 col-md-8">{{ event.name }}</div>
        </div>
        <div class="row">
          <div class="col-sm-12 col-md-4 fw-bold"><i class="fas fa-pencil-alt fa-fw text-primary"></i>&nbsp;Popis</div>
          <div class="col-sm-12 col-md-8">{{ event.description }}</div>
        </div>
        <div class="row">
          <div class="col-sm-12 col-md-4 fw-bold"><i class="fas fa-gamepad fa-fw text-primary"></i>&nbsp;Typ</div>
          <div class="col-sm-12 col-md-8">{{ event.type?.label }}</div>
        </div>
      </div>
    </div>

    <div class="card mt-2">
      <div class="card-body">
        <h4 class="text-primary">Obmedzenia</h4>
        <div class="row">
          <div class="col-sm-12 col-md-4 fw-bold"><i class="fas fa-users fa-fw text-primary"></i>&nbsp;Počet tímov</div>
          <div class="col-sm-12 col-md-8" *ngIf="event.min_teams != event.max_teams">
            {{ event.min_teams }} - {{ event.max_teams }}
          </div>
          <div class="col-sm-12 col-md-8" *ngIf="event.min_teams == event.max_teams">{{ event.min_teams }}</div>
        </div>
        <div class="row">
          <div class="col-sm-12 col-md-4 fw-bold"><i class="fas fa-user fa-fw text-primary"></i>&nbsp;Počet hráčov v tíme</div>
          <div class="col-sm-12 col-md-8" *ngIf="event.min_team_members != event.max_team_members">
            {{ event.min_team_members }} - {{ event.max_team_members }}
          </div>
          <div class="col-sm-12 col-md-8" *ngIf="event.min_team_members == event.max_team_members">
            {{ event.min_team_members }}
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-sm-12 col-lg-6 mb-2">
    <div class="card">
      <div class="card-body">
        <div class="row">
          <div class="col-sm-12 col-md-4 fw-bold"><i class="fas fa-crown fa-fw text-primary"></i>&nbsp;Zakladateľ</div>
          <div class="col-sm-12 col-md-8">{{ event.owner.firstname }} {{ event.owner.surname }}</div>
        </div>
        <div class="row">
          <div class="col-sm-12 col-md-4 fw-bold"><i class="fas fa-calendar fa-fw text-primary"></i>&nbsp;Vytvorený</div>
          <div class="col-sm-12 col-md-8">{{ event.created_at | date: 'shortDate' }}</div>
        </div>
      </div>
    </div>

    <div class="card mt-2">
      <div class="card-body">
        <div class="row">
          <div class="col-sm-12 col-md-4 fw-bold"><i class="fas fa-clock fa-fw text-primary"></i>&nbsp;Registrácia</div>
          <div class="col-sm-12 col-md-8">
            {{ event.registration_start | date: 'short' }} - {{ event.registration_end | date: 'short' }}
          </div>
        </div>
        <div class="row">
          <div class="col-sm-12 col-md-4 fw-bold"><i class="fas fa-play fa-fw text-primary"></i>&nbsp;Začiatok</div>
          <div class="col-sm-12 col-md-8">{{ event.event_start | date: 'short' }}</div>
        </div>
        <div class="row">
          <div class="col-sm-12 col-md-4 fw-bold"><i class="fas fa-flag-checkered fa-fw text-primary"></i>&nbsp;Koniec</div>
          <div class="col-sm-12 col-md-8">{{ event.event_end | date: 'short' }}</div>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-container *ngIf="event">
  <h3 class="text-primary mt-4 d-flex justify-content-between align-items-end">
    Tímy na podujatí

    <button class="btn btn-primary" *ngIf="!addTeam && this.hasAction('addTeam')" (click)="addTeam = true">Prihlásiť sa</button>
    <button class="btn btn-outline-primary" *ngIf="addTeam && this.hasAction('addTeam')" (click)="addTeam = false">Zrušiť</button>
  </h3>

  <div class="card mb-4" *ngIf="addTeam">
    <div class="card-body">
      <form #ngForm="ngForm">
        <div class="form-group form-group-spaced" *ngIf="availibleTeams?.length">
          <label class="form-control-required" for="event.teamId">Tím</label>
          <ng-select
            [items]="availibleTeams"
            bindValue="id"
            bindLabel="team_name"
            [(ngModel)]="teamId"
            id="event.teamId"
            name="event.teamId"
            [required]="true"
          ></ng-select>
        </div>

        <div class="form-group form-group-spaced" *ngIf="!availibleTeams?.length">
          <div class="alert alert-warning m-0">
            Žiaden z vaších tímov nevyhovuje nastaveniam podujatia, môžete <a routerLink="/team/new">vytvoriť nový</a> alebo
            pridajte/odoberte členov zo <a routerLink="/dashboard">svojich tímov</a>.
          </div>
        </div>

        <div class="form-group form-group-spaced" *ngIf="addTeamError">
          <div class="alert alert-danger m-0">
            {{ addTeamError }}
          </div>
        </div>

        <div class="form-group form-group-spaced mt-2" *ngIf="availibleTeams?.length">
          <button class="btn btn-primary" type="button" (click)="add()">Prihlásiť na podujatie</button>
        </div>
      </form>
    </div>
  </div>

  <div class="card" *ngIf="!event?.teams_on_event?.length">
    <div class="card-body">
      <div class="alert alert-warning m-0">
        Na toto podujatie nie je prihlásený žiaden tím.
        <button class="btn btn-link p-0" *ngIf="hasAction('addTeam')" (click)="addTeam = true">Prihláste svoj tím</button>.
      </div>
    </div>
  </div>
  <div class="row" *ngIf="event?.teams_on_event?.length">
    <div class="col-sm-12 col-md-6" *ngFor="let t of event.teams_on_event">
      <div class="card">
        <div class="card-body">
          <div class="row">
            <div class="col">
              <!--prettier-ignore-->
              <div class="row">
                <div class="col-sm-12 col-md-6 col-lg-4 fw-bold"><i class="fas fa-list fa-fw text-primary"></i>&nbsp;Názov</div>
                <div class="col-sm-12 col-md-6 col-lg-8"><a routerLink="/team/detail/{{ t.id }}">{{ t.team_name }}</a></div>
              </div>
              <!--prettier-ignore-->
              <div class="row">
                <div class="col-sm-12 col-md-6 col-lg-4 fw-bold"><i class="fas fa-crown fa-fw text-primary"></i>&nbsp;Zakladateľ</div>
                <div class="col-sm-12 col-md-6 col-lg-8">{{ t.owner?.firstname }} {{ t.owner?.surname }}</div>
              </div>

              <!--prettier-ignore-->
              <div class="mt-4">
                <span class="pe-3" title="Počet výhier"><i class="fas fa-trophy text-primary pe-1"></i>{{ t.wins || 0 }}</span>
                <span class="pe-3" title="Počet hier"><i class="fas fa-check text-primary pe-1"></i>{{ t.events_total || 0 }}</span>
                <span class="pe-3" title="Počet bodov"><i class="fas fa-hashtag text-primary pe-1"></i>{{ t.points || 0 }}</span>
                <span class="pe-3" title="Počet členov"><i class="fas fa-users text-primary pe-1"></i>{{ t.users?.length || 0 }}</span>
              </div>
            </div>
            <div class="col-sm-12 mt-2 mt-lg-0 col-lg-auto d-flex flex-column flex-column-reverse">
              <button
                class="btn btn-outline-primary"
                [disabled]="!(hasAction('removeTeam') && user.id === t.owner.id)"
                (click)="remove(t)"
              >
                Odhlásiť
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-container>
